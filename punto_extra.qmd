---
title: "Modelos - Punto Extra"
lang: es
author: "Marcelino"
date: today
format:
  html:
    code-fold: true
    number-sections: true
    toc: true
    toc-depth: 3
    page-layout: full
    embed-resources: true
---

# Intrucciones

Considera dos variables $X$ y $Y$ con distribución exponencial donde una tiene valor esperado que sea el doble del valor esperado de la otra (tú decides el parámetro).

1.  Escoge al menos 5 tipos de cópulas para modelar la dependencia entre ellas, para cada cópula escoge parámetros que reflejen una dependencia negativa y una dependencia positiva (en total tendrás 10 modelos). Para cada uno de los 10 modelos:
    a.  Muestra la función de distribución conjunta de $X$ y $Y$ (la fórmula).
    b.  Grafica la función de densidad conjunta de $X$ y $Y$.
    c.  Varianza de $X$, $Y$ y $X + Y$.
    d.  Desviación estándar de $X$, $Y$ y $X + Y$.
    e.  Cuantil al 95% de $X$, $Y$ y $X + Y$.
    f.  Valor esperado condicional de la cola al 95% de $X$, $Y$ y $X + Y$.

2.  Repite el inciso anterior; pero ahora considera que $X$ y $Y$ tienen distribución pareto donde una tiene valor esperado que sea el doble del valor esperado de la otra (tú decides los parámetros).

# Solución

## Caso Exponencial

Tenemos las siguientes variables aleatorias:

$$X\sim \textbf{Exp}(\lambda)$$

$$Y\sim \textbf{Exp}(2\lambda)$$

donde $F_{x}(x)=1-e^{-\lambda x}$ y $F_{y}(y)=1-e^{-2\lambda y}$

```{r, echo=TRUE, message=FALSE, warning=FALSE}
library(copula)
library(lattice)
source("codigo.R")

# Exponential distribution for both marginals
lambda <- 1
# Parameters for the marginals
# You can adjust these parameters as needed
params1 <- lambda # Rate for the first exponential distribution
params2 <- 2*lambda # Rate for the second exponential distribution

```

### Cópula Gaussiana

$$C(u,v)=\Phi_{2}(\Phi^{-1}(u),\Phi^{-1}(v), \rho)$$

donde $\Phi_{2}$ es la función de distribución conjunta de una distribución normal bivariada con media cero y varianza uno y correlación $\rho$ (esta determinará la relación negativa o positiva de las variables); y $\Phi$ es la función de distribución de una distribución normal estándar.


#### Función de distribución conjunta

$$H(x, y) = \Phi_{2}\left(\Phi^{-1}(1 - e^{-\lambda x}), \Phi^{-1}(1 - e^{-2\lambda y}); \rho \right)$$

#### Función de densidad conjunta

```{r, message=FALSE, warning=FALSE}
library(copula)

rho =.9

# Definir cópula gaussiana
myCopulaP1 <- normalCopula(rho, dim = 2)
myCopulaN1 <- normalCopula(-rho, dim = 2)

grafCopula1 <- graficaDensidadCopulas(myCopulaP1,myCopulaN1)

```


##### Caso Positivo
```{r}

grafCopula1[1] 
```

##### Caso Negativo
```{r}
grafCopula1[2]
```

#### Resultados

Para obtener los resultados de las estadísticas pedidas se generó una muestra de 10000 observaciones de la cópula y se calcularon las estadísticas para cada una de las variables aleatorias $X$ y $Y$ y para la suma de ambas $X+Y$. Cabe resaltar que como sí conocemos muy bien las variables aleatorias $X$ y $Y$, las estadísticas de estas fueron calculadas de manera analítica.

```{r, eval=FALSE}


```


### Cópula t-Student

$$C(u,v)=\textbf{t}_{\nu}(\textbf{t}_{\nu}^{-1}(u),\textbf{t}_{\nu}^{-1}(v); \rho)$$

donde $\textbf{t}_{\nu}(;\rho)$ es la función de distribución conjunta de una distribución t-Student bivariada estandarizada y con correlación $\rho$ (esta determinará la relación negativa o positiva de las variables); y $\textbf{t}_{\nu}$ es la función de distribución de una distribución univaria t-Student.

#### Función de distribución conjunta

$$H(x, y) = \textbf{t}_{\nu}(\textbf{t}_{\nu}^{-1}(1 - e^{-\lambda x}), \textbf{t}_{\nu}^{-1}(1 - e^{-2\lambda y}); \rho)$$


#### Función de densidad conjunta

```{r, message=FALSE, warning=FALSE}

# Parámetros de la cópula y las distribuciones marginales
rho = 0.9
df = 4 # Grados de libertad para la cópula t de Student
params1 = 1 # Parámetro para la primera distribución exponencial
params2 = 1 # Parámetro para la segunda distribución exponencial

# Definir cópulas t de Student
myCopulaP2 <- tCopula(rho, dim = 2, df = df)
myCopulaN2 <- tCopula(-rho, dim = 2, df = df)

grafCopula2 <- graficaDensidadCopulas(myCopulaP2,myCopulaN2)
```

##### Caso Positivo
```{r}
# Mostrar los gráficos
grafCopula2[1]

```



##### Caso Negativo
```{r}
# Mostrar los gráficos
grafCopula2[2]

```



### Arquimediana Clayton

$$C(u,v)=\phi^{-1}(\phi(u)+\phi(v))$$ 

donde $\phi(u)=\frac{1}{\theta}\left(t^{-\theta}-1\right)$

#### Función de distribución conjunta

$$H(x, y) = \max \left\{ \left((1 - e^{-\lambda x})^{-\theta} + (1 - e^{-2\lambda y})^{-\theta} - 1\right)^{-1/\theta}, 0 \right\}$$

#### Función de densidad conjunta

```{r}
# Definir parámetros de la cópula de Clayton
theta1 = 2 #  dependencia positiva
theta2 = -.9 #  dependencia negativa

# Definir cópulas de Clayton
myCopulaP3 <- claytonCopula(theta1, dim = 2)
myCopulaN3 <- claytonCopula(theta2, dim = 2)

grafCopula3 <- graficaDensidadCopulas(myCopulaP3,myCopulaN3)
```

##### Caso Positivo

```{r}
grafCopula3[1]
```


##### Caso Negativo

```{r}
grafCopula3[2]
```


### Arquimediana Frank

$$C(u,v)=\phi^{-1}(\phi(u)+\phi(v))$$ 

donde $\phi(u)=-\ln\frac{e^{-\theta u}-1}{e^{-\theta }-1}$

#### Función de distribución conjunta


$$H(x, y) = -\frac{1}{\theta} \ln \left( 1 + \frac{(e^{-\theta (1 - e^{-\lambda x})} - 1)(e^{-\theta (1 - e^{-2\lambda y})} - 1)}{e^{-\theta} - 1} \right)$$

#### Función de densidad conjunta

```{r}

theta1 = 10 #  dependencia positiva
theta2 = -15 #  dependencia negativa

# Definir cópulas de Clayton
myCopulaP4 <- frankCopula(theta1, dim = 2)
myCopulaN4 <- frankCopula(theta2, dim = 2)

grafCopula4 <- graficaDensidadCopulas(myCopulaP4,myCopulaN4)

```

##### Caso Positivo

```{r}
grafCopula4[1]
```


##### Caso Negativo

```{r}
grafCopula4[2]
```

### Arquimediana Ali-Mikhail-Haq (AMH)

$$C(u,v)=\phi^{-1}(\phi(u)+\phi(v))$$ 

donde $\phi(u)=\ln\frac{1-\theta(1-u)}{u}$

#### Función de distribución conjunta

$$H(x, y) =\frac{(1 - e^{-\lambda x})(1 - e^{-2\lambda y})}{1 - \theta (e^{-\lambda x})((e^{-2\lambda y}))} $$


#### Función de densidad conjunta

```{r}

theta1 = 1 #  dependencia positiva
theta2 = -1 #  dependencia negativa

# Definir cópulas de Clayton
myCopulaP5 <- amhCopula(theta1, dim = 2)
myCopulaN5 <- amhCopula(theta2, dim = 2)

grafCopula5 <- graficaDensidadCopulas(myCopulaP5,myCopulaN5)

```

##### Caso Positivo

```{r}
grafCopula5[1]
```


##### Caso Negativo

```{r}
grafCopula5[2]
```

## Caso Pareto

Tenemos las siguientes variables aleatorias:

$$X\sim \textbf{Pareto}(\alpha, 2\nu)$$

$$Y\sim \textbf{Pareto}(\alpha, \nu)$$

donde $F_{x}(x)=1-\left(\frac{2\nu}{x+2\nu}\right)^{\alpha}$ y $F_{y}(y)=1-\left(\frac{\nu}{y+\nu}\right)^{\alpha}$

```{r}
library(actuar)
# Params of a pareto
nu <- 1
pareto_params1 <- 2*nu 
pareto_params2 <- nu 

alpha <- 2
```

### Cópula Gaussiana

$$C(u,v)=\Phi_{2}(\Phi^{-1}(u),\Phi^{-1}(v))$$

#### Función de distribución conjunta

$$H(x, y) = \Phi_{2}\left(\Phi^{-1}\left(1-\left(\frac{2\nu}{x+2\nu}\right)^{\alpha}\right), \Phi^{-1}\left(1-\left(\frac{\nu}{y+\nu}\right)^{\alpha}\right); \rho \right)$$

#### Función de densidad conjunta

```{r}
rho =.9

# Definir cópula gaussiana
myCopulaP1 <- normalCopula(rho, dim = 2)
myCopulaN1 <- normalCopula(-rho, dim = 2)

pgrafCopula1 <- graficaDensidadCopulas2(myCopulaP1,myCopulaN1)
```

##### Caso Positivo
```{r}

pgrafCopula1[1] 
```

##### Caso Negativo
```{r}
pgrafCopula1[2]
```

### Cópula t-Student

$$C(u,v)=\textbf{t}_{\nu}(\textbf{t}_{\nu}^{-1}(u),\textbf{t}_{\nu}^{-1}(v); \rho)$$

donde $\textbf{t}_{\nu}(;\rho)$ es la función de distribución conjunta de una distribución t-Student bivariada estandarizada y con correlación $\rho$ (esta determinará la relación negativa o positiva de las variables); y $\textbf{t}_{\nu}$ es la función de distribución de una distribución univaria t-Student.

#### Función de distribución conjunta

$$H(x, y) = \textbf{t}_{\nu}\left(\textbf{t}_{\nu}^{-1}(1-\left(\frac{2\nu}{x+2\nu}\right)^{\alpha}), \textbf{t}_{\nu}^{-1}(1-\left(\frac{\nu}{y+\nu}\right)^{\alpha}); \rho \right)$$

#### Función de densidad conjunta

```{r}
# Parámetros de la cópula y las distribuciones marginales
rho = 0.9
df = 4 
# Definir cópulas t de Student
myCopulaP2 <- tCopula(rho, dim = 2, df = df)
myCopulaN2 <- tCopula(-rho, dim = 2, df = df)

pgrafCopula2 <- graficaDensidadCopulas2(myCopulaP2,myCopulaN2)
```

##### Caso Positivo
```{r}
pgrafCopula2[1] 
```

##### Caso Negativo
```{r}
pgrafCopula2[2]
```

### Arquimediana clayton

$$C(u,v)=\phi^{-1}(\phi(u)+\phi(v))$$ 

donde $\phi(u)=\frac{1}{\theta}\left(t^{-\theta}-1\right)$

#### Función de distribución conjunta

$$H(x, y) = \max \left\{\left( \left(1-\left(\frac{2\nu}{x+2\nu}\right)^{\alpha}\right)^{-\theta} + \left(1-\left(\frac{\nu}{y+\nu}\right)^{\alpha}\right)^{-\theta} - 1\right)^{-1/\theta}, 0 \right\}$$

#### Función de densidad conjunta

```{r}
# Definir parámetros de la cópula de Clayton
theta1 = 2 #  dependencia positiva
theta2 = -.9 #  dependencia negativa

# Definir cópulas de Clayton
myCopulaP3 <- claytonCopula(theta1, dim = 2)
myCopulaN3 <- claytonCopula(theta2, dim = 2)

pgrafCopula3 <- graficaDensidadCopulas2(myCopulaP3,myCopulaN3)
```

##### Caso Positivo
```{r}
pgrafCopula3[1] 
```

##### Caso Negativo
```{r}
pgrafCopula3[2]
```

### Arquimediana Frank

$$C(u,v)=\phi^{-1}(\phi(u)+\phi(v))$$ 

donde $\phi(u)=-\ln\frac{e^{-\theta u}-1}{e^{-\theta }-1}$

#### Función de distribución conjunta

$$H(x, y) = -\frac{1}{\theta} \ln \left( 1 + \frac{\left(e^{-\theta \left(1-\left(\frac{2\nu}{x+2\nu}\right)^{\alpha}\right)} - 1\right)\left(e^{-\theta \left(1-\left(\frac{\nu}{y+\nu}\right)^{\alpha}\right)} - 1\right)}{e^{-\theta} - 1} \right)$$

#### Función de densidad conjunta

```{r}
theta1 = 10 #  dependencia positiva
theta2 = -15 #  dependencia negativa

# Definir cópulas de Clayton
myCopulaP4 <- frankCopula(theta1, dim = 2)
myCopulaN4 <- frankCopula(theta2, dim = 2)

pgrafCopula4 <- graficaDensidadCopulas2(myCopulaP4,myCopulaN4)
```

##### Caso Positivo
```{r}
pgrafCopula4[1] 
```

##### Caso Negativo
```{r}
pgrafCopula4[2]
```



### Arquimediana Ali-Mikhail-Haq (AMH)

$$C(u,v)=\phi^{-1}(\phi(u)+\phi(v))$$ 

donde $\phi(u)=\ln\frac{1-\theta(1-u)}{u}$

#### Función de distribución conjunta

$$H(x, y) =\frac{\left(1-\left(\frac{2\nu}{x+2\nu}\right)^{\alpha}\right)\left(1-\left(\frac{\nu}{y+\nu}\right)^{\alpha}\right)}{1 - \theta \left(\frac{2\nu}{x+2\nu}\right)^{\alpha}\left(\frac{\nu}{y+\nu}\right)^{\alpha}} $$

#### Función de densidad conjunta

```{r}
theta1 = 1 #  dependencia positiva
theta2 = -1 #  dependencia negativa

# Definir cópulas de Clayton
myCopulaP5 <- amhCopula(theta1, dim = 2)
myCopulaN5 <- amhCopula(theta2, dim = 2)

pgrafCopula5 <- graficaDensidadCopulas2(myCopulaP5,myCopulaN5)
```

##### Caso Positivo
```{r}
pgrafCopula5[1] 
```

##### Caso Negativo
```{r}
pgrafCopula5[2]
```



